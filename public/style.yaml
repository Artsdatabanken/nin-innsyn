import:
  - https://tangrams.github.io/blocks/filter/grain.yaml

cameras:
  cam:
    type: flat

sources:
  osm:
    type: MVT
    url: 'https://tiles.artsdatabanken.no/data/openstreetmap/{z}/{x}/{y}.pbf'
    max_zoom: 14
  # This source should be dynamically created and set on the multiply-layer
  multiply:
    type: Raster
    url: 'https://tiles.artsdatabanken.no/data/NA_T1/{z}/{x}/{y}.png'
    rasters: [MI_KA-A]
    max_zoom: 11

styles:
  water:
    base: polygons
    mix: filter-grain
    shaders:
      defines:
        GRAIN_AMOUNT: .8
        NUM_OCTAVES: 3
  boundary:
    base: lines
    order: 150
    blend: overlay
    dash: [2, 0.5]

  tricolor:
    base: polygons
    blend: multiply
    raster: color
    shaders:
      blocks:
        filter: |
          vec3 colorx = vec3(0.392157,1,0.015686);
          vec3 colory = vec3(0.015686,0.768627,1);
          vec3 color_overlap = vec3(0.975,0.,0.);
          vec3 transparent = vec3(1.);
          float x = sampleRaster(0).r;
          float y = sampleRaster(1).r;
          vec3 cx = mix(colorx * x + colory * y, color_overlap, x * y);
          color = vec4(mix(transparent,cx, x + y),1.);
  rainbows:
    base: polygons
    blend: 'overlay'
    raster: color
    shaders:
      blocks:
        filter: |
          float r, g, b = 0.;
          float a = 1.;
          float i = sampleRaster(0).r * sampleRaster(1).r;
          if(i == 0.){
            a = 0.;
          }
          // Up to cyan
          else if(i <= .25) {
            b = 1.;
            g = i / .25;
          }
          // Up to green
          else if(i <= .5) {
            g = 1.;
            b = 1. - ((i - .25) / .25);
          }
          // Up to yellow
          else if(i <= .75) {
            g = 1. ;
            r = (i - .5) / .25;
          }
          // Up to red
          else {
            r = 1.;
            g = 1. - ((i - .75) / .25) ;
          }
          color = vec4(r, g, b, a);
